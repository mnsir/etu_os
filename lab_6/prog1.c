#include <time.h>    /* nanosleep */
#include <pthread.h> /* pthread_create pthread_join */
#include <stdio.h>   /* printf getchar */

#include "verify.h"

int FLAG; /* объявить флаг завершения потока */
/* объявить идентификатор семафора записи */
/* объявить идентификатор семафора чтения */
/* объявить идентификатор разделяемой памяти */
/* объявить локальный адрес */

/* функция потока */
void *func(void *args)
{
    int num;          /* объявить переменную */
    while (FLAG != 1) /* пока (флаг завершения потока не установлен) */
    {
        /* присвоить переменной случайное значение */
        printf("%d\n", num); /* вывести значение переменной на экран */
        /* скопировать значение переменной в локальный адрес */
        /* освободить семафор записи */
        /* ждать семафора чтения */
        struct timespec ts = {.tv_nsec = 50 * 1000000}; /* задержать на время */
        nanosleep(&ts, NULL);
    }
}

/* основная программа */
int main()
{
    pthread_t th; /* объявить идентификатор потока */
    /* создать (или открыть, если существует) разделяемую память */
    /* обрезать разделяемую память до требуемого размера */
    /* отобразить разделяемую память на локальный адрес */
    /* создать (или открыть, если существует) семафор записи */
    /* создать (или открыть, если существует) семафор чтения */
    VERIFY(pthread_create(&th, NULL, &func, NULL) == 0); /* создать поток из функции потока */
    getchar();                                           /* ждать нажатия клавиши */
    FLAG = 1;                                            /* установить флаг завершения потока */
    VERIFY(pthread_join(th, NULL) == 0);                 /* ждать завершения потока */
    /* закрыть семафор чтения */
    /* удалить семафор чтения */
    /* закрыть семафор записи */
    /* удалить семафор записи */
    /* закрыть отображение разделяемой памяти на локальный адрес */
    /* удалить разделяемую память */
}